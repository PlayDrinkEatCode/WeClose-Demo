"use strict";(self.webpackChunkwepie_activity=self.webpackChunkwepie_activity||[]).push([["299"],{3646:function(t,e,a){a.r(e),a.d(e,{default:function(){return G}});var n=a(83279),s=a(67627),r=a(63066),i=a(85556),o=a(50003),c=a(79751),u=a(69778),l=a(61069),f=(0,u.r8)(function(){var t=["home","near","mine"],e={home:"#F2F5FA"},a=(0,l.ref)("1"),n=function(e){a.value=String(e),p(t[e-1])},s=(0,l.ref)(""),r=(0,l.ref)(["home"]),i=(0,l.ref)(["home"]),o=(0,l.computed)(function(){return r.value[r.value.length-1]}),c=(0,l.ref)("#F2F5FA"),u=function(){var t;c.value=null!==(t=e[o.value])&&void 0!==t?t:"#FFFFFF"},f=(0,l.ref)({}),p=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(r.value.includes(e)){var l=r.value.indexOf(e);r.value.splice(l,1)}if(s.value=c,f.value=o,t.includes(e)){var p=t.indexOf(e)+1;p!==+a.value&&n(p)}r.value.push(e),u();var h="".concat(e).concat(Object.keys(o).length>0?"&data=".concat(encodeURIComponent(JSON.stringify(o))):"").concat(c?"&title=".concat(encodeURIComponent(c)):"");if(location.hash=h,i.value.includes(h)){var v=i.value.indexOf(h);i.value.splice(v,1)}i.value.push(h),i.value.length>5&&i.value.shift(),i.value.includes("home")||i.value.unshift("home")},h=function(t){if(t){var e=t.split("&")[0].replace("#","");t=t.replace("#".concat(e),"");var a="";if(t.includes("&title=")){var n=t.split("&title=")[1];a=decodeURIComponent(n),t=t.replace("&title=".concat(n),"")}var s={};t.includes("&data=")&&(s=JSON.parse(decodeURIComponent(t.split("&data=")[1]))),p(e,s,a)}};return{tabPages:t,hideTitlePages:["mark","route","lth"],tab:a,setTab:n,title:s,page:o,setPage:p,setPageByHash:h,bgColor:c,setBgColor:u,data:f,back:function(){i.value.pop();var t=i.value.pop();t&&h(t)}}}),p=a(10364),h=(0,p.Z)({__name:"navigation",setup:function(t){var e=f();return{__sfc:!0,tabPages:e.tabPages,hideTitlePages:e.hideTitlePages,title:e.title,page:e.page,back:e.back}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{directives:[{name:"show",rawName:"v-show",value:!e.tabPages.includes(e.page)&&!e.hideTitlePages.includes(e.page),expression:"!tabPages.includes(page) && !hideTitlePages.includes(page)"}],staticClass:"fx-shrink-0",attrs:{wh:"100% 1.12","bg-c":"#FFFFFF"}},[t(c.Z,{attrs:{pl:"0.46",pc:"y","bg-i":"icon/back"},on:{"a-tap":e.back}}),t("a-section",{attrs:{pc:"xy",f:"0.32 #171E2C 500"}},[this._v(" "+this._s(e.title)+" ")])],1)},[],!1,null,null,null).exports,v=(0,p.Z)({__name:"tabs",setup:function(t){var e=f();return{__sfc:!0,tabPages:e.tabPages,tab:e.tab,setTab:e.setTab,page:e.page}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{directives:[{name:"show",rawName:"v-show",value:e.tabPages.includes(e.page),expression:"tabPages.includes(page)"}],staticClass:"fx-shrink-0",attrs:{wh:"100% 1.12","bg-c":"#FFFFFF"}},[t("a-section",{staticClass:"fx-row",staticStyle:{gap:"0.68rem"},attrs:{pc:"x",w:"6.38"}},this._l(3,function(a){return t(c.Z,{key:a,attrs:{"bg-i":"icon/tab-".concat(a).concat(+e.tab===a?"-active":"")},on:{"a-tap":function(t){return e.setTab(a)}}})}),1)],1)},[],!1,null,null,null).exports,d=a(24350),g=a(86485),m=a(54832),_=(0,p.Z)({__name:"tag",props:{active:{type:Boolean,required:!1,default:!1},id:{type:Number,required:!1},content:{type:String,required:!0}},emits:["active-change"],setup:function(t,e){var a=e.emit,n=(0,m.f)(),s=f().page,r=(0,l.ref)(t.active);return{__sfc:!0,props:t,emit:a,ins:n,page:s,active:r,changeActive:function(){"write"===s.value&&(r.value=!r.value,a("active-change",r.value,n.$props.id))}}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"fx-row fx-c-center",staticStyle:{width:"fit-content"},attrs:{h:"0.44",bdr:"0.22","bg-c":e.active?"#D4FCF8":"#ECECEC"},on:{"a-tap":e.changeActive}},[t("a-section",{attrs:{ml:"0.1",mr:"0.1",wh:"0.32","bg-i":"icon/tag-".concat(+e.active)}}),t(d.Z,{attrs:{mr:"0.14",f:"0.24 ".concat(e.active?"#3B8A87":"#A3A3A3"," 400"),content:this.content}})],1)},[],!1,null,null,null).exports,b=a(83533),y=a.n(b),w=(0,u.r8)(function(){var t,e=(0,m.f)(),a=y().create({timeout:1e4,headers:{"Content-Type":"application/json"}});return{buildApi:function(t){return function(){var n,s,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.post(t,r,{baseURL:null==e?void 0:null===(s=e.$route.meta)||void 0===s?void 0:null===(n=s.json)||void 0===n?void 0:n.baseURL})}},concatCatch:(t=(0,i._)(function(t){var a;return(0,o.Jh)(this,function(n){switch(n.label){case 0:return[4,t.then(function(t){return[null,t.data]}).catch(function(t){return[t,null]})];case 1:return(a=n.sent())[0]&&(null==e||e.$toast("请连接内部网络")),[2,a]}})}),function(e){return t.apply(this,arguments)})}}),x=a(11392),k=(0,u.r8)(function(){var t=(0,g._)((0,x._)("is-like",!0),2);return{isLike:t[0],setIsLike:t[1]}}),C=(0,u.r8)(function(){var t,e=w(),a=e.buildApi,n=e.concatCatch,s=a("tags/list"),r=(0,l.ref)([]),c=(t=(0,i._)(function(){var t,e,a;return(0,o.Jh)(this,function(i){switch(i.label){case 0:return[4,n(s())];case 1:if(e=(t=g._.apply(void 0,[i.sent(),2]))[0],a=t[1],e)return[2];return r.value=a.list,[2]}})}),function(){return t.apply(this,arguments)});return(0,l.onMounted)(function(){c()}),{tags:r}}),F=(0,u.r8)(function(){var t,e=w(),a=e.buildApi,n=e.concatCatch,s=a("/user/new_random_user"),r=(0,g._)((0,x._)("userInfo",{}),2),c=r[0],u=r[1],f=(t=(0,i._)(function(){var t,e,a;return(0,o.Jh)(this,function(r){switch(r.label){case 0:return[4,n(s())];case 1:if(e=(t=g._.apply(void 0,[r.sent(),2]))[0],a=t[1],e)return[2];return u(a),[2]}})}),function(){return t.apply(this,arguments)});return(0,l.onMounted)(function(){c.value.id||f()}),{userInfo:c}}),S=(0,p.Z)({__name:"post",props:{type:{type:String,required:!0},request:{type:Boolean,default:!0},id:Number,userId:Number,content:String,images:{type:Array,default:function(){return[]}},tagIds:{type:Array,default:function(){return[]}},createdAt:Number,likeCount:{type:Number,default:0},isSpecial:{type:Boolean,default:!1}},setup:function(t){var e,a,n,s=(0,m.f)(),r=f(),c=r.page,u=r.setPage,p=w(),h=p.buildApi,v=p.concatCatch,d=h("/posts/get_by_id"),b=h("/post_like/get"),y=h("/user/get_by_id"),x=h("/post_like/update_liked"),S=(0,l.ref)(t.userId),A=(0,l.ref)(""),P=(0,l.ref)(""),T=(0,l.ref)(t.content),Z=(0,l.ref)(t.images),I=(0,l.ref)(t.tagIds),D=(0,l.ref)("反正不是火星"),$=(0,l.ref)(t.createdAt),E=(0,l.ref)(t.likeCount),L=(0,l.ref)(!1),R=k(),N=R.isLike,B=R.setIsLike,M=C().tags,J=F().userInfo,U=(0,l.computed)(function(){return t.isSpecial?["羽毛球馆避雷"]:M.value.filter(function(t){return I.value.includes(t.id)}).map(function(t){return t.name})}),z=(0,l.computed)(function(){var t,e=null!==(t=$.value)&&void 0!==t?t:+new Date/1e3,a=+new Date/1e3-e;return a<60?"刚刚":a<3600?"".concat(Math.floor(a/60),"分钟前"):a<86400?"".concat(Math.floor(a/3600),"小时前"):a<604800?"".concat(Math.floor(a/86400),"天前"):s.$dayjsTz(1e3*e).format("YYYY-MM-DD")}),q=(0,l.ref)(0),j=(0,l.ref)(t.likeCount),H=(e=(0,i._)(function(){var t,e,a;return(0,o.Jh)(this,function(n){switch(n.label){case 0:if(!S.value)return[2];return[4,v(y({id:S.value}))];case 1:if(e=(t=g._.apply(void 0,[n.sent(),2]))[0],a=t[1],e)return[2];return a.avatar?a.avatar.startsWith("data:")?A.value=a.avatar:A.value="data:".concat(a.avatar):A.value=s.$route.meta.assets["avatar/special"],P.value=a.user_name,[2]}})}),function(){return e.apply(this,arguments)}),O=function(){var t=s.$route.meta.assets;A.value=t["avatar/special"],P.value="可口可乐",T.value="周末去奥体打球，好热，人太多了，臭烘烘的，空气流动性贼差，下次换个场地，夏季避雷！！！！",Z.value=[t["image/1"],t["image/2"],t["image/3"]],D.value="奥体羽毛球馆",$.value=0x6896d92c,L.value=N.value,E.value=L.value?1012:1011},W=(a=(0,i._)(function(){var e,a,n,s;return(0,o.Jh)(this,function(r){switch(r.label){case 0:return[4,v(d({post_id:t.id}))];case 1:if(a=(e=g._.apply(void 0,[r.sent(),2]))[0],n=e[1],a)return[2];return s=n,S.value=s.user_id,T.value=s.content,Z.value=s.images.map(function(t){return t.startsWith("data:")?t:"data:".concat(t)}),I.value=s.post_tags,$.value=s.created_at,E.value=s.like_count,j.value=E.value,[2]}})}),function(){return a.apply(this,arguments)}),Y=(n=(0,i._)(function(){var e,a,n;return(0,o.Jh)(this,function(s){switch(s.label){case 0:if(!J.value.id)return[2];return[4,v(b({post_id:t.id,user_id:J.value.id}))];case 1:if(a=(e=g._.apply(void 0,[s.sent(),2]))[0],n=e[1],a)return[2];return L.value=n.is_like,[2]}})}),function(){return n.apply(this,arguments)});return(0,l.watch)(function(){return S.value},function(){!t.isSpecial&&(H(),Y())},{immediate:!0}),(0,l.watch)(function(){return J.value},function(){J.value.id&&t.id&&Y()},{immediate:!0}),(0,l.onMounted)(function(){if(t.isSpecial){O();return}t.request&&W()}),{__sfc:!0,props:t,ins:s,page:c,setPage:u,buildApi:h,concatCatch:v,getPostById:d,getPostLike:b,getUserInfoById:y,updatePostLike:x,userId:S,avatar:A,nickname:P,content:T,images:Z,tagIds:I,location:D,createdAt:$,likeCount:E,isLike:L,specialIsLike:N,setSpecialIsLike:B,tags:M,userInfo:J,tagNames:U,time:z,likeTapTimeout:q,likeKeepCount:j,getUserInfo:H,toDetail:function(e){"detail"!==c.value&&u("detail",{id:e,isSpecial:t.isSpecial},"详情")},comment:function(){"detail"===c.value&&s.$toast("待会儿再说吧～")},like:function(){if(t.isSpecial){B(!N.value),L.value=N.value,E.value=L.value?1012:1011;return}q.value&&clearTimeout(q.value),q.value=setTimeout((0,i._)(function(){return(0,o.Jh)(this,function(e){switch(e.label){case 0:if(j.value===E.value)return[2];return[4,v(x({post_id:t.id,user_id:J.value.id,is_like:+L.value}))];case 1:if(g._.apply(void 0,[e.sent(),1])[0])return[2];return j.value=E.value,Y(),[2]}})}),1e3),L.value=!L.value,E.value+=L.value?1:-1},getSpecialPostDetail:O,getPostDetail:W,getUserLike:Y,tag:_}}},function(){var t=this,e=t._self._c,a=t._self._setupProxy;return e("a-section",{attrs:{ml:"auto",mr:"auto",w:"card"===t.type?"6.86":"100%","bg-c":"#FFFFFF",bdr:.16*("card"===t.type)},on:{"a-tap":function(e){return a.toDetail(t.id)}}},[e("a-section",{attrs:{ml:"auto",mr:"auto",pdt:"0.13",pdb:"0.13",w:"6.6"}},[e("a-section",{staticClass:"fx-row fx-c-center",attrs:{w:"100%"}},[e("a-img",{directives:[{name:"show",rawName:"v-show",value:a.avatar,expression:"avatar"}],attrs:{wh:"0.72",bdr:"50%",src:a.avatar}}),e("a-section",{directives:[{name:"show",rawName:"v-show",value:!a.avatar,expression:"!avatar"}],attrs:{"bg-c":"#F6F6F6",wh:"0.72",bdr:"50%"}}),e(d.Z,{attrs:{ml:"0.18",f:"0.3 #171E2C 500",content:a.nickname}})],1),e(d.Z,{staticClass:"txt-l",attrs:{mt:"0.13",ml:"auto",mr:"auto",w:"6.4",lh:"0.48",f:"0.28 #171E2C 400",content:a.content}}),e("a-section",{staticClass:"fx-row fx-wrap",staticStyle:{gap:"0.1rem"},attrs:{mt:"0.13",w:"100%"}},t._l(a.tagNames,function(t){return e(a.tag,{key:t,attrs:{active:!0,content:t}})}),1),"card"===t.type?e("a-section",{key:"gqt0nqlp35g"},[e("a-section",{staticClass:"fx-row of-a",staticStyle:{gap:"0.15rem"},attrs:{mt:"0.13",ml:"0.15",w:"6.2"}},t._l(a.images,function(t){return e("a-img",{key:t,staticClass:"fx-shrink-0",attrs:{src:t,wh:"1.8",bdr:"0.1"}})}),1)],1):e("a-section",{key:"ta3x2werzur"},[e("a-section",{staticClass:"fx-row fx-wrap",staticStyle:{gap:"0.1rem"},attrs:{mt:"0.13",ml:"0.2",w:"6.2"}},t._l(a.images,function(t){return e("a-img",{key:t,staticClass:"fx-shrink-0",attrs:{src:t,wh:"2",bdr:"0.1"}})}),1)],1),e("a-section",{staticClass:"fx-row fx-c-center",attrs:{mt:"0.13",w:"100%"}},[e("a-section",{attrs:{"bg-i":"btn/location"}}),e(d.Z,{attrs:{ml:"0.06",f:"0.24 #9197A3 400",content:a.location}}),e(d.Z,{attrs:{ml:"0.2",f:"0.24 #9197A3 400",content:a.time}}),e(c.Z,{attrs:{ml:"auto","bg-i":"btn/comment"},on:{"a-tap":a.comment}}),e(d.Z,{attrs:{ml:"0.08",f:"0.24 #9197A3 400",content:2}}),e("a-section",{staticClass:"fx-row fx-c-center",attrs:{ml:"0.3"}},[e("a-section",[e(c.Z,{attrs:{"bg-i":a.isLike?"btn/good-active":"btn/good","throttle-time":0},on:{click:function(t){return t.stopPropagation(),a.like.apply(null,arguments)}}})],1),e(d.Z,{attrs:{ml:"0.08",f:"0.24 #9197A3 400",content:a.likeCount}})],1)],1)],1)],1)},[],!1,null,null,null).exports,A=(0,u.r8)(function(){var t=(0,m.f)();return{stayTuned:function(){null==t||t.$toast("敬请期待 (๑•̀ㅂ•́)و✧")},notDeveloped:function(){null==t||t.$toast("暂未开发 ..(｡•ˇ‸ˇ•｡)..")}}}),P=(0,p.Z)({__name:"detail",setup:function(t){var e=(0,m.f)();return{__sfc:!0,ins:e,data:f().data,notDeveloped:A().notDeveloped,comment:function(){e.$toast("待会儿再说吧～")},share:function(){e.$toast("正在建立意识连接...")},post:S}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"fx-col",attrs:{wh:"100%"}},[t("a-section",{staticClass:"fx-1 fx-col of-a"},[t(e.post,{attrs:{type:"normal",id:e.data.id,"is-special":e.data.isSpecial}}),t("a-section",{attrs:{w:"100%"}},[t("a-section",{attrs:{pc:"x"}},[t("a-section",{attrs:{mt:"0.16",mb:"0.16","bg-i":"icon/split-line"}}),t("a-section",{attrs:{"bg-i":"icon/comment-joke"},on:{"a-tap":e.notDeveloped}})],1)],1)],1),t("a-section",{attrs:{"bg-i":"icon/detail-bottom"}},[t("a-section",{attrs:{pl:"0.24",pc:"y",wh:"5.84 0.8"},on:{"a-tap":e.comment}}),t("a-section",{attrs:{pl:"6.34",pc:"y",wh:"0.84 0.8"},on:{"a-tap":e.share}})],1)],1)},[],!1,null,null,null).exports,T=a(5967),Z=a(96921),I=a(10277),D=(0,p.Z)({__name:"fixed",props:{pt:{type:[String,Number]},pb:{type:[String,Number]},pl:{type:[String,Number]},pr:{type:[String,Number]},pc:{type:String},pz:{type:[String,Number],default:0},wh:{type:[String,Number],default:"fit-content"}},setup:function(t){var e=(0,l.computed)(function(){return(0,Z._)((0,T._)({},t),{pz:void 0})});return{__sfc:!0,props:t,tapAreaStyle:e}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"tap-through",staticStyle:{position:"fixed"},attrs:{pt:"0",pz:this.pz,ml:"auto",mr:"auto",wh:"7.5 100%"}},[t("a-section",this._b({staticStyle:{"pointer-events":"auto"}},"a-section",e.tapAreaStyle,!1),[this._t("default")],2)],1)},[],!1,null,null,null).exports,$=a(57776),E=(0,p.Z)({__name:"search",setup:function(t){var e=(0,m.f)();return{__sfc:!0,ins:e,search:function(){var t=e.$refs.inputRef.value;e.$refs.inputRef.$el.value="",t?e.$toast("你搜索了：".concat(t)):e.$toast("请输入搜索内容")}}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"fx-shrink-0",attrs:{mt:"0.3",mb:"0.2",ml:"auto",mr:"auto",bdr:"0.4",wh:"6.86 0.8","bg-c":"#FAFAFA"}},[t(c.Z,{attrs:{pl:"0.24",pc:"y","bg-i":"btn/search"},on:{"a-tap":e.search}}),t("a-section",{attrs:{pl:"0.8",wh:"5.82 100%",f:"0.28 #BABBC2 500"}},[t($.Z,{ref:"inputRef",attrs:{type:"text",placeholder:"搜动态/话题/用户",maxlength:"20"}})],1)],1)},[],!1,null,null,null).exports,L=a(51756);a(41486);var R=(0,p.Z)({__name:"home",setup:function(t){var e,a=(0,l.ref)(),n=f().setPage,s=A().stayTuned,r=w(),c=r.buildApi,u=r.concatCatch,p=c("posts/list"),h=(0,l.ref)(function(){return 1}),v=(0,l.ref)(0),d=(0,l.ref)([]),m=(0,l.ref)(!0),_=(e=(0,i._)(function(){var t,e,a,n;return(0,o.Jh)(this,function(s){switch(s.label){case 0:if(!m.value)return[2];return m.value=!1,[4,u(p({cursor:v.value}))];case 1:if(a=(e=g._.apply(void 0,[s.sent(),2]))[0],n=e[1],a)return m.value=!1,[2];return v.value=n.cursor,(t=d.value).push.apply(t,(0,I._)(n.data.map(function(t){return(0,Z._)((0,T._)({},t),{images:t.images.map(function(t){return t.startsWith("data:")?t:"data:".concat(t)})})}))),0===v.value?m.value=!1:m.value=!0,y(),[2]}})}),function(){return e.apply(this,arguments)}),b=function(){n("rank",{},"排行榜")},y=function(){var t=a.value,e=t.scrollTop,n=t.scrollHeight;e+t.clientHeight>=n-50&&_()};return(0,l.watch)(function(){return a.value},function(){a.value.addEventListener("scroll",y)}),(0,l.onMounted)(function(){_()}),{__sfc:!0,pageRef:a,setPage:n,stayTuned:s,buildApi:c,concatCatch:u,getPosts:p,activeIndex:h,swiperOptions:{loop:!0,autoplay:{delay:3e3,disableOnInteraction:!1},on:{slideChange:function(){h.value=this.activeIndex%2}}},cursor:v,postList:d,hasMore:m,fix:function(t){t.target.classList.contains("swiper-1")?b():s()},getPostList:_,toWrite:function(){n("write",{},"发帖")},toRank:b,scroll:y,fixed:D,post:S,search:E,Swiper:L.Swiper,SwiperSlide:L.SwiperSlide}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"fx-col",attrs:{wh:"100%"}},[t(e.fixed,[t("a-section",{attrs:{"bg-i":"bg/home-top"}})],1),t(e.search),t("a-section",{ref:"pageRef",staticClass:"fx-col of-a",staticStyle:{gap:"0.24rem"},attrs:{wh:"100%"}},[t("a-section",{staticClass:"fx-shrink-0 of-h",attrs:{mt:"0.32",mb:"0.33",ml:"auto",mr:"auto",bdr:"0.16",wh:"6.86 4.2"}},[t(e.Swiper,{ref:"swiperRef",staticStyle:{width:"100%",height:"100%",transform:"translateZ(0)"},attrs:{options:e.swiperOptions},on:{click:e.fix}},[t(e.SwiperSlide,[t("a-section",{staticClass:"swiper-1",attrs:{wh:"6.86 4.2","bg-i":"swiper/1"}})],1),t(e.SwiperSlide,[t("a-section",{staticClass:"swiper-2",attrs:{wh:"100%","bg-i":"swiper/2"}})],1)],1),t("a-section",{staticClass:"fx-row fx-m-center fx-c-center tap-through",staticStyle:{gap:"0.16rem"},attrs:{pb:"0",pc:"x",wh:"100% 0.48",pz:"2"}},this._l(2,function(a){return t("a-section",{key:a,staticStyle:{transition:"all 0.2s ease-in-out"},attrs:{wh:a%2==e.activeIndex%2?"0.4 0.16":"0.16",bdr:"0.08","bg-c":a%2==e.activeIndex%2?"#FFFFFF":"#171E2C"}})}),1)],1),t(e.post,{attrs:{type:"card","is-special":!0}}),this._l(e.postList,function(a){return t(e.post,{key:a.id,attrs:{type:"card",request:!1,id:a.id,"user-id":a.user_id,content:a.content,images:a.images,"tag-ids":a.post_tags,"like-count":a.like_count,"created-at":a.created_at}})}),t("a-section",{staticClass:"fx-shrink-0",attrs:{mt:"-0.24",wh:"100% 1.84"}}),t(e.fixed,{attrs:{pr:"0.26",pb:"1.4"}},[t(c.Z,{attrs:{"bg-i":"btn/to-write"},on:{"a-tap":e.toWrite}})],1)],2)],1)},[],!1,null,null,null).exports,N=(0,p.Z)({__name:"back",setup:function(t){return{__sfc:!0,back:f().back,fixed:D}}},function(){var t=this._self._c,e=this._self._setupProxy;return t(e.fixed,{attrs:{pt:"0.26",pl:"0.46",pz:"1"}},[t("a-section",{attrs:{"bg-i":"icon/back-gray"},on:{"a-tap":e.back}})],1)},[],!1,null,null,null).exports,B=(0,p.Z)({__name:"lth",setup:function(t){return{__sfc:!0,stayTuned:A().stayTuned,back:N}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"fx-col",attrs:{wh:"100%"}},[t(e.back),t("a-section",{attrs:{pt:"0","bg-i":"near/1"},on:{"a-tap":e.stayTuned}})],1)},[],!1,null,null,null).exports,M=(0,u.r8)(function(){var t,e=w(),a=e.buildApi,n=e.concatCatch,s=a("/ratings/get_ave"),r=(0,l.ref)(!1),c=(0,l.ref)(""),u=(t=(0,i._)(function(){var t,e,a;return(0,o.Jh)(this,function(i){switch(i.label){case 0:return[4,n(s({post_id:1}))];case 1:if(e=(t=g._.apply(void 0,[i.sent(),2]))[0],a=t[1],e)return[2];return 0===a.rating_count?(r.value=!1,c.value="暂无评分"):(r.value=!0,c.value=a.rating_ave.toFixed(1)+"分"),[2]}})}),function(){return t.apply(this,arguments)});return{hasAveScore:r,averageScore:c,getAverageScore:u}}),J=(0,p.Z)({__name:"mark1",setup:function(t){var e,a,n=(0,m.f)(),s=F().userInfo,r=M(),c=r.hasAveScore,u=r.averageScore,f=r.getAverageScore,p=A().notDeveloped,h=w(),v=h.buildApi,d=h.concatCatch,_=v("/ratings/get"),b=v("/ratings/create"),y=(0,l.ref)(0),x=(e=(0,i._)(function(){var t,e,a;return(0,o.Jh)(this,function(n){switch(n.label){case 0:return[4,d(_({post_id:1,user_id:s.value.id}))];case 1:if(e=(t=g._.apply(void 0,[n.sent(),2]))[0],a=t[1],e)return[2];return y.value=a.rating,[2]}})}),function(){return e.apply(this,arguments)}),k=(a=(0,i._)(function(t){return(0,o.Jh)(this,function(e){switch(e.label){case 0:if(0!==y.value)return null==n||n.$toast("已经评过分啦～"),[2];return[4,d(b({post_id:1,user_id:s.value.id,rating:t}))];case 1:if(g._.apply(void 0,[e.sent(),1])[0])return[2];return y.value=t,null==n||n.$toast("评分成功～"),f(),[2]}})}),function(t){return a.apply(this,arguments)});return(0,l.watch)(function(){return s.value},function(){s.value.id&&x()},{immediate:!0}),(0,l.onMounted)(function(){f()}),{__sfc:!0,ins:n,userInfo:s,hasAveScore:c,averageScore:u,getAverageScore:f,notDeveloped:p,buildApi:v,concatCatch:d,getScore:_,setScore:b,userScore:y,getUserScore:x,setUserScore:k,back:N}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"fx-col",attrs:{wh:"100%"}},[t(e.back),t("a-section",{staticClass:"fx-1 of-a"},[t("a-section",{attrs:{"bg-i":"mark/bg"}},[t("a-section",{staticClass:"fx-row",attrs:{pl:"0.32",pt:"8.44"}},this._l(10,function(a){return t("a-section",{key:a,attrs:{ml:"0.05","bg-i":"mark/star-".concat(a<6?0:1)},on:{"a-tap":function(t){e.setUserScore(a-6+(a<6?0:1))}}},[t("a-section",{directives:[{name:"show",rawName:"v-show",value:a<6?e.userScore<=a-6:e.userScore>=a-5,expression:"i < 6 ? userScore <= i - 6 : userScore >= i - 5"}],attrs:{"bg-i":"mark/star-".concat(a<6?0:1,"-fill")}}),t(d.Z,{attrs:{pt:"0.44",pc:"x",f:"0.2 ".concat(a<6?"#D9D9D9":"#22E0BA"," 500"),content:a-6+(a<6?0:1)}})],1)}),1),t(d.Z,{attrs:{pt:"8.5",pr:"0.35",f:"".concat(e.hasAveScore?"0.4":"0.32"," #1CCCA9 700"),content:e.averageScore}})],1)],1),t("a-section",{attrs:{"bg-i":"mark/bottom"},on:{"a-tap":e.notDeveloped}})],1)},[],!1,null,null,null).exports,U=(0,p.Z)({__name:"mine",setup:function(t){return{__sfc:!0,notDeveloped:A().notDeveloped}}},function(){var t=this._self._c;return t("a-section",{attrs:{wh:"100%"}},[t("a-section",{attrs:{"bg-i":"mine/content"},on:{"a-tap":this._self._setupProxy.notDeveloped}})],1)},[],!1,null,null,null).exports,z=a(12853),q=(0,p.Z)({__name:"near",setup:function(t){var e=(0,m.f)(),a=(0,z.R)().openBgCloseDialog,n=f().setPage,s=A().stayTuned,r=(0,l.ref)("1"),i=(0,l.ref)(!1),o=(0,l.ref)({1:0,2:0,3:0});return{__sfc:!0,ins:e,openBgCloseDialog:a,setPage:n,stayTuned:s,tabNames:["附近","发现","兴趣"],tab:r,active:i,scrollTops:o,setTab:function(t){o.value[+r.value]=e.$refs.tabsRef.$el.scrollTop,r.value=String(t),(0,l.nextTick)(function(){e.$refs.tabsRef.$el.scrollTop=o.value[+t]})},toRoute:function(){n("route")},openDialog:function(){a("code")},toLTH:function(){n("lth")},fixed:D,search:E}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"fx-col",attrs:{pt:"0",wh:"100%"}},[t("a-section",{staticClass:"fx-shrink-0 fx-row",attrs:{ml:"auto",mr:"auto",wh:"6.9 1.1"}},this._l(3,function(a){return t("a-section",{key:a,staticClass:"fx-1",attrs:{mt:"auto",mb:"auto",h:"0.48"},on:{"a-tap":function(t){return e.setTab(a)}}},[t(d.Z,{attrs:{f:"0.32 #171E2C 500",content:e.tabNames[a-1]}}),t("a-section",{staticStyle:{transition:"width 0.2s"},attrs:{pt:"0.48",pc:"x","bg-c":"#22E0BA",wh:+e.tab===a?"1.04 0.14":"0 0",bdr:"0.07"}})],1)}),1),t("a-tabs",{ref:"tabsRef",staticClass:"of-h-x",attrs:{wh:"100%","bg-c":"#F6F6F6",active:e.tab,items:["1","2","3"]}},["1"===e.tab?t("a-section",{key:"65lv6423ln",staticClass:"fx-col",attrs:{slot:"1",mt:e.active?0:"8rem",wh:"100%","bg-c":"#F6F6F6"},slot:"1"},[t(e.fixed,{attrs:{pt:"1.1",pc:"x"}},[t("a-section",{attrs:{"bg-i":"map/bg"},on:{"a-tap":e.stayTuned}})],1),t("a-section",{attrs:{"bg-c":"#F6F6F6"}},[t("a-section",{staticStyle:{position:"sticky"},attrs:{pt:"0",pl:"0",pz:"2","bg-c":"#F6F6F6"}},[t(e.search),t("a-section",{attrs:{ml:"auto",mr:"auto","bg-i":"near/icons"},on:{"a-tap":e.stayTuned}}),t("a-section",{attrs:{wh:"100% 0.3"}})],1),t("a-section",{attrs:{ml:"auto",mr:"auto","bg-i":"near/content"},on:{"a-tap":e.stayTuned}},[t("a-section",{attrs:{pt:"0",pc:"x",wh:"6.86 3"},on:{"a-tap":e.toLTH}})],1),t("a-section",{attrs:{wh:"100% 0.3"}})],1)],1):this._e(),"2"===e.tab?t("a-section",{key:"hruax1b6ie4",attrs:{slot:"2"},slot:"2"},[t("a-section",{staticStyle:{position:"sticky"},attrs:{pt:"0",pl:"0",pz:"2","bg-i":"find/tabs"},on:{"a-tap":e.stayTuned}}),this._l(3,function(a){return t("a-section",{key:a,attrs:{mt:"0.2",ml:"auto",mr:"auto","bg-i":"find/".concat(a)},on:{"a-tap":function(t){1===a?e.toRoute():e.stayTuned()}}})}),t("a-section",{attrs:{wh:"100% 0.2"}})],2):this._e(),"3"===e.tab?t("a-section",{key:"0v1d8fqagt3e",attrs:{slot:"3"},slot:"3"},[this._l(4,function(a){return t("a-section",{key:a,attrs:{mt:"0.3",ml:"auto",mr:"auto","bg-i":"group/".concat(a)},on:{"a-tap":function(t){1===a?e.openDialog():e.stayTuned()}}})}),t("a-section",{attrs:{wh:"100% 0.3"}})],2):this._e()],1)],1)},[],!1,null,null,null).exports,j=(0,p.Z)({__name:"rank",setup:function(t){var e=(0,m.f)(),a=f().setPage,n=M(),s=n.hasAveScore,r=n.averageScore,i=n.getAverageScore,o=A().stayTuned,c=(0,l.ref)("1"),u=(0,l.ref)({1:0,2:0,3:0});return(0,l.onMounted)(function(){i()}),{__sfc:!0,ins:e,setPage:a,hasAveScore:s,averageScore:r,getAverageScore:i,stayTuned:o,tabNames:["美食榜","租房榜","生活榜"],tab:c,scrollTops:u,setTab:function(t){u.value[+c.value]=e.$refs.pageRef.scrollTop,c.value=String(t),(0,l.nextTick)(function(){e.$refs.pageRef.scrollTop=u.value[+t]})},toMark:function(){a("mark")}}}},function(){var t=this,e=t._self._c,a=t._self._setupProxy;return e("a-section",{staticClass:"fx-col",attrs:{wh:"100%"}},[e("a-section",{staticClass:"fx-shrink-0 fx-row text-center",staticStyle:{gap:"0.3rem"},attrs:{ml:"auto",mr:"auto",wh:"6.9 1.1"}},t._l(3,function(t){return e("a-section",{key:t,staticClass:"text-center",staticStyle:{transition:"background-color 0.2s"},attrs:{wh:"2 0.56",bdr:"0.28","bg-c":+a.tab===t?"#22E0BA":"#FFFFFF"},on:{"a-tap":function(e){return a.setTab(t)}}},[e(d.Z,{staticStyle:{transition:"color 0.2s"},attrs:{f:"0.32 ".concat(+a.tab===t?"#FFFFFF":"#5F6671"," 500"),content:a.tabNames[t-1]}})],1)}),1),e("a-section",{ref:"pageRef",staticClass:"fx-1 of-y-a of-h-x",attrs:{"bg-c":"#F2F5FA"}},[e("a-tabs",{attrs:{active:a.tab,items:["1","2","3"]}},t._l(3,function(n){return e("a-section",{key:n,attrs:{slot:n,pc:"x","bg-i":"rank/".concat(n)},slot:n},[e("a-section",{attrs:{pc:"x",wh:"100%"},on:{"a-tap":a.stayTuned}}),1===n?e("a-section",{key:"x32kxrwzm7",attrs:{pt:"1.28",pc:"x",wh:"6.86 1.5"},on:{"a-tap":a.toMark}},[e(d.Z,{attrs:{pt:"0.48",pr:"0.26",lh:"0.45",f:"".concat(a.hasAveScore?"0.32":"0.24"," #1CCCA9 700"),content:a.averageScore}})],1):t._e()],1)}),1)],1)],1)},[],!1,null,null,null).exports,H=(0,p.Z)({__name:"route",setup:function(t){return{__sfc:!0,notDeveloped:A().notDeveloped,back:N}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"fx-col",attrs:{wh:"100%"},on:{"a-tap":e.notDeveloped}},[t(e.back),t("a-section",{staticClass:"fx-1 of-a"},[t("a-section",{attrs:{"bg-i":"route/content"}})],1),t("a-section",{attrs:{"bg-i":"mark/bottom"}})],1)},[],!1,null,null,null).exports,O=(0,u.r8)(function(){var t=function(t,e){var a=t/e;return a>1?{width:500,height:Math.round(500/a)}:{width:Math.round(500*a),height:500}};return{compressImage:function(e){return new Promise(function(a){var n=new Image;n.addEventListener("load",function(){if(n.width<=500&&n.height<=500){a(e);return}var s=t(n.width,n.height),r=s.width,i=s.height,o=document.createElement("canvas"),c=o.getContext("2d");if(o.width=r,o.height=i,!c){a(null);return}c.drawImage(n,0,0,r,i),a(o.toDataURL("image/jpeg"))}),n.addEventListener("error",function(){return a(null)}),n.src=e})}}}),W=(0,p.Z)({__name:"write",setup:function(t){var e,a=(0,m.f)(),n=f().setPage,s=A().notDeveloped,r=w(),c=r.buildApi,u=r.concatCatch,p=c("posts/create"),h=F().userInfo,v=(0,l.ref)(!0),d=(0,l.ref)([]),b=C().tags,y=(0,l.ref)([]),x=O().compressImage,k=(e=(0,i._)(function(){var t,e,s,r;return(0,o.Jh)(this,function(i){switch(i.label){case 0:if(v.value)return a.$toast("内容不能为空！"),[2];return t=a.$refs.textareaRef.value,[4,u(p({user_id:h.value.id,content:t,images:d.value,post_tags:y.value}))];case 1:if(s=(e=g._.apply(void 0,[i.sent(),2]))[0],r=e[1],s)return[2];return a.$toast("发布成功"),n("detail",{id:r.id},"详情"),[2]}})}),function(){return e.apply(this,arguments)});return{__sfc:!0,ins:a,setPage:n,notDeveloped:s,buildApi:c,concatCatch:u,createPost:p,userInfo:h,isEmpty:v,images:d,tags:b,activeTags:y,compressImage:x,handleInput:function(){var t=a.$refs.textareaRef.value;v.value=0===t.length},selectImage:function(){var t=document.createElement("input");t.type="file",t.accept="image/*",t.multiple=!0,t.onchange=function(t){var e=Array.from(t.target.files),n=0;Promise.all(e.map(function(t){return new Promise(function(e,s){if(++n>9){e(null);return}var r=new FileReader;r.readAsDataURL(t),r.addEventListener("load",(0,i._)(function(){var t;return(0,o.Jh)(this,function(n){switch(n.label){case 0:return[4,x(r.result)];case 1:return(t=n.sent())?e(t):(a.$toast("图片压缩失败"),e(null)),[2]}})})),r.addEventListener("error",function(){return e(null)})})})).then(function(t){var e;t.length>9&&a.$toast("最多只能上传9张图片"),(e=d.value).push.apply(e,(0,I._)(t.filter(function(t){return null!==t})))}).catch(function(){a.$toast("图片上传失败")})},t.click()},handleTagActiveChange:function(t,e){t?y.value.push(e):y.value=y.value.filter(function(t){return t!==e})},commit:k,tag:_}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"of-a",attrs:{wh:"100%"}},[t("a-section",{attrs:{ml:"auto",mr:"auto",w:"6.6"}},[t("a-section",{attrs:{wh:"100% 2.56",f:"0.32 #BEC2CA 500"}},[t("textarea",{ref:"textareaRef",staticStyle:{width:"100%",height:"100%",border:"none",outline:"none"},attrs:{placeholder:"说说菜品、体验感、服务怎么样，给大家参考~"},on:{input:e.handleInput}})]),t("a-section",{staticClass:"fx-row fx-wrap",staticStyle:{gap:"0.2rem"},attrs:{mt:"0.2",w:"100%"}},[this._l(e.images,function(e){return t("a-section",{key:e,staticClass:"of-a",attrs:{wh:"2","bg-c":"#F6F6F6",b:"0.01 solid #E7EAF0",bdr:"0.16"}},[t("a-img",{attrs:{wh:"100%",src:e}})],1)}),e.images.length<9?t("a-section",{key:"dza00vic91m",attrs:{wh:"2","bg-c":"#F6F6F6",b:"0.01 solid #E7EAF0",bdr:"0.16"},on:{"a-tap":e.selectImage}},[t("a-section",{attrs:{pc:"xy","bg-i":"icon/add"}})],1):this._e()],2)],1),t("a-section",{attrs:{mt:"1",ml:"auto",mr:"auto","bg-i":"icon/add-tag"}},[t("a-section",{attrs:{pr:"0.26",pc:"y",wh:"1.26 0.44"},on:{"a-tap":e.notDeveloped}})],1),t("a-section",{staticClass:"fx-row fx-wrap",staticStyle:{gap:"0.2rem"},attrs:{mt:"0.24",mb:"0.24",ml:"auto",mr:"auto",w:"6.6"}},this._l(e.tags,function(a){return t(e.tag,{key:a.id,attrs:{id:a.id,content:a.name},on:{"active-change":e.handleTagActiveChange}})}),1),t("a-section",{attrs:{mt:"0.1",mb:"0.1","bg-i":"icon/location"},on:{"a-tap":e.notDeveloped}}),t("a-section",{staticStyle:{position:"sticky"},attrs:{pb:"0",wh:"100% 1.26"}},[t(c.Z,{attrs:{pc:"x",mb:"0.3",wh:"6.86 0.96",bdr:"0.48","bg-c":e.isEmpty?"#88E0D7":"#00B2A0"},on:{"a-tap":e.commit}},[t("a-section",{staticClass:"text-center",attrs:{wh:"100%",f:"0.32 #FFFFFF 700"}},[this._v("发布")])],1)],1)],1)},[],!1,null,null,null).exports,Y=(0,p.Z)({__name:"page",setup:function(t){var e=f();return{__sfc:!0,page:e.page,bgColor:e.bgColor,detail:P,home:R,lth:B,mark1:J,mine:U,near:q,rank:j,route:H,write:W}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"fx-1 of-a",attrs:{"bg-c":e.bgColor}},["home"===e.page?t(e.home,{key:"45y5y6aij9t"}):this._e(),"near"===e.page?t(e.near,{key:"q3lfd29dbq"}):this._e(),"mine"===e.page?t(e.mine,{key:"ck1bcovto5"}):this._e(),"rank"===e.page?t(e.rank,{key:"1is7ntjy3qw"}):this._e(),"mark"===e.page?t(e.mark1,{key:"0mbbvx9ax40i"}):this._e(),"detail"===e.page?t(e.detail,{key:"9k482e3xb8r"}):this._e(),"write"===e.page?t(e.write,{key:"9ew2dc0xsi6"}):this._e(),"route"===e.page?t(e.route,{key:"sheotrv5ezj"}):this._e(),"lth"===e.page?t(e.lth,{key:"xjezlfeybr"}):this._e()],1)},[],!1,null,null,null).exports,K=a(86663),G=(0,p.Z)({__name:"page",setup:function(t){var e=(0,m.f)(),a=(0,K.sq)(),n=(0,l.ref)(0),s=f().setPageByHash,r=function(){e.$storage.init({})},c=function(){n.value=window.innerHeight+"px"};return(0,l.onBeforeMount)(function(){e.$base.amInit({loading:!0,blockLoading:(0,i._)(function(){return(0,o.Jh)(this,function(t){return[2]})})}),r()}),(0,l.onMounted)(function(){c(),window.addEventListener("resize",c),s(location.hash),e.$router.beforeEach(function(t,e,a){s(t.hash),a()})}),{__sfc:!0,ins:e,compUiMeta:a,height:n,setPageByHash:s,init:r,getHeight:c,navigation:h,tabs:v,page:Y}}},function(){var t=this._self._c,e=this._self._setupProxy;return t("a-section",{staticClass:"of-h-x txt-c",attrs:{id:"act-page-main"}},[t(r.Z,{staticClass:"fx-col",attrs:{ml:"auto",mr:"auto",wh:"7.5 ".concat(e.height),order:"0"}},[t(e.navigation),t(e.page),t(e.tabs)],1),t(r.Z,{attrs:{order:"2"}},[t(s.Z,[t(n.Z,{attrs:{"ui-meta":e.compUiMeta.staticDialogs}})],1)],1)],1)},[],!1,null,null,null).exports}}]);